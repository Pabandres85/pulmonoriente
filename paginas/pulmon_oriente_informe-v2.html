<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pulmón del Oriente · Informe de Inversión · Cali 2024–2027</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --verde-bosque:   #1B4D2E;
    --verde-esmeralda:#2E7D52;
    --verde-claro:    #4CAF50;
    --verde-menta:    #A5D6A7;
    --verde-hielo:    #E8F5E9;
    --tierra:         #5D4037;
    --ocre:           #F57F17;
    --ocre-claro:     #FFF8E1;
    --rojo-alerta:    #7B3535;
    --rojo-claro:     #F5EDED;
    --azul-agua:      #0277BD;
    --azul-claro:     #E1F5FE;
    --blanco:         #FAFAFA;
    --gris-papel:     #F4F1EC;
    --gris-text:      #37474F;
    --gris-light:     #90A4AE;
    --negro:          #1A1A1A;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    background: var(--gris-papel);
    font-family: 'Inter', sans-serif; /* <-- Letra limpia para lectura */
    color: var(--negro);
    min-height: 100vh;
  }
  h1, h2, h3, .hero-kpi-val, .stat-num { 
    font-family: 'Montserrat', sans-serif; /* <-- Letra potente para títulos y KPIs */
  }
  .section-num, .hero-date, .chart-badge, .barrio-bar-val, .ring-pct { 
    font-family: 'JetBrains Mono', monospace; /* <-- Letra técnica para códigos */
  }

  /* ─── HERO ─── */
  .hero {
    background: linear-gradient(155deg, var(--verde-bosque) 0%, #0D2E1A 40%, #1B3A2A 70%, #0A2218 100%);
    position: relative;
    overflow: hidden;
    padding: 0;
  }
  .hero-bg-art {
    position: absolute; inset: 0; opacity: 0.07;
    background-image: 
      radial-gradient(circle at 20% 50%, #4CAF50 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, #81C784 0%, transparent 40%),
      radial-gradient(circle at 60% 80%, #A5D6A7 0%, transparent 35%);
  }
  .hero-lines {
    position: absolute; inset: 0; opacity: 0.04;
    background-image: repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(255,255,255,0.3) 40px),
                      repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(255,255,255,0.3) 40px);
  }
  .hero-inner {
    position: relative; z-index: 2;
    max-width: 1200px; margin: 0 auto;
    padding: 72px 40px 56px;
    display: grid; grid-template-columns: 1fr auto; gap: 40px; align-items: end;
  }
  .hero-tag {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(76,175,80,0.2); border: 1px solid rgba(76,175,80,0.4);
    border-radius: 100px; padding: 6px 16px;
    color: var(--verde-menta); font-size: 11px; font-weight: 600;
    letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px;
  }
  .hero-tag::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: var(--verde-claro); }
  h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(36px, 5vw, 64px);
    font-weight: 900; color: #fff; line-height: 1.05;
    text-shadow: 0 2px 20px rgba(0,0,0,0.3);
  }
  h1 span { color: var(--verde-menta); }
  .hero-sub {
    color: rgba(255,255,255,0.7); font-size: 15px;
    font-style: italic; margin-top: 12px; line-height: 1.6;
  }
  .hero-date {
    color: var(--verde-menta); font-family: 'IBM Plex Mono', monospace;
    font-size: 12px; margin-top: 20px; letter-spacing: 1px;
  }
  .hero-kpi-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 12px; min-width: 260px;
  }
  .hero-kpi {
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px; padding: 16px 20px;
    backdrop-filter: blur(8px);
  }
  .hero-kpi-val {
    font-family: 'Playfair Display', serif;
    font-size: 26px; font-weight: 700; color: #fff; line-height: 1;
  }
  .hero-kpi-lbl {
    font-size: 10px; color: rgba(255,255,255,0.55); margin-top: 4px;
    text-transform: uppercase; letter-spacing: 1px;
  }
  .hero-kpi.accent { background: rgba(76,175,80,0.25); border-color: rgba(76,175,80,0.4); }
  .hero-kpi.accent .hero-kpi-val { color: var(--verde-menta); }

  /* ─── LAYOUT ─── */
  .container { max-width: 1200px; margin: 0 auto; padding: 0 40px; }

  /* ─── ALERT BANNER ─── */
  .alert-strip {
    background: #5C2E2E;
    color: #F9ECEC; padding: 12px 40px;
    font-size: 13px; font-weight: 600;
    display: flex; align-items: center; gap: 12px;
  }
  .alert-strip span { opacity: 0.8; font-weight: 300; }

  /* ─── SECTION ─── */
  .section { padding: 56px 0; }
  .section-header {
    display: flex; align-items: baseline; gap: 16px; margin-bottom: 36px;
  }
  .section-num {
    font-family: 'IBM Plex Mono', monospace; font-size: 11px;
    color: var(--verde-esmeralda); letter-spacing: 3px;
    text-transform: uppercase;
  }
  h2 {
    font-family: 'Playfair Display', serif;
    font-size: 28px; font-weight: 700; color: var(--verde-bosque);
  }
  .divider {
    height: 1px; background: linear-gradient(to right, var(--verde-menta), transparent);
    margin: 0 0 36px;
  }

  /* ─── CHART CARDS ─── */
  .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 28px; }
  .charts-grid.three { grid-template-columns: 1fr 1fr 1fr; }
  .charts-grid.wide { grid-template-columns: 2fr 1fr; }

  .chart-card {
    background: #fff; border-radius: 16px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.05);
  }
  .chart-card-header {
    padding: 20px 24px 0;
    display: flex; justify-content: space-between; align-items: flex-start;
  }
  .chart-card-title {
    font-size: 13px; font-weight: 600; color: var(--verde-bosque);
    text-transform: uppercase; letter-spacing: 1px;
  }
  .chart-card-sub {
    font-size: 11px; color: var(--gris-light); margin-top: 3px;
  }
  .chart-badge {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 10px; padding: 4px 10px; border-radius: 100px;
    background: var(--verde-hielo); color: var(--verde-bosque);
  }
  .chart-body { padding: 16px 24px 20px; }
  canvas { display: block; width: 100% !important; }

  /* ─── STAT CARDS ─── */
  .stats-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 28px; }
  .stat-card {
    background: #fff; border-radius: 14px; padding: 22px 20px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    border-top: 4px solid var(--verde-claro);
    position: relative; overflow: hidden;
  }
  .stat-card.alerta { border-top-color: var(--rojo-alerta); }
  .stat-card.alistamiento { border-top-color: var(--azul-agua); }
  .stat-card.ejecucion { border-top-color: var(--verde-claro); }
  .stat-card.terminado { border-top-color: var(--verde-bosque); }
  .stat-card.suspendido { border-top-color: var(--ocre); }
  .stat-card::after {
    content: ''; position: absolute; bottom: -20px; right: -20px;
    width: 80px; height: 80px; border-radius: 50%;
    background: rgba(0,0,0,0.025);
  }
  .stat-num {
    font-family: 'Playfair Display', serif;
    font-size: 32px; font-weight: 700; line-height: 1;
    color: var(--verde-bosque);
  }
  .stat-card.alerta .stat-num { color: var(--rojo-alerta); }
  .stat-card.alistamiento .stat-num { color: var(--azul-agua); }
  .stat-lbl { font-size: 11px; color: var(--gris-light); margin-top: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
  .stat-sub { font-size: 12px; color: var(--gris-text); margin-top: 8px; line-height: 1.4; }

  /* ─── TABLE ─── */
  .table-wrap { background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 24px rgba(0,0,0,0.06); }
  table { width: 100%; border-collapse: collapse; }
  th {
    background: var(--verde-bosque); color: #fff;
    padding: 12px 16px; font-size: 10px;
    text-transform: uppercase; letter-spacing: 1px;
    text-align: left; font-weight: 600;
  }
  td {
    padding: 11px 16px; font-size: 12px; 
    border-bottom: 1px solid rgba(0,0,0,0.04);
    color: var(--gris-text);
    vertical-align: middle;
  }
  tr:last-child td { border-bottom: none; }
  tr:nth-child(even) td { background: var(--verde-hielo); }
  tr:hover td { background: #E8F5E9; }
  .pill {
    display: inline-block; padding: 3px 10px;
    border-radius: 100px; font-size: 10px; font-weight: 600;
  }
  .pill-ej { background: #DCEDC8; color: #33691E; }
  .pill-al { background: var(--azul-claro); color: var(--azul-agua); }
  .pill-ok { background: #C8E6C9; color: #1B5E20; }
  .pill-sus { background: var(--rojo-claro); color: var(--rojo-alerta); }
  .pill-liq { background: var(--ocre-claro); color: var(--ocre); }

  /* ─── ANALYSIS BOX ─── */
  .analysis-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .analysis-card {
    background: #fff; border-radius: 16px; padding: 28px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.06);
  }
  .analysis-card.full { grid-column: 1 / -1; }
  .analysis-card h3 {
    font-family: 'Playfair Display', serif;
    font-size: 18px; color: var(--verde-bosque); margin-bottom: 16px;
    padding-bottom: 12px; border-bottom: 2px solid var(--verde-menta);
  }
  .analysis-card p { font-size: 13px; line-height: 1.8; color: var(--gris-text); margin-bottom: 10px; }
  .analysis-card p:last-child { margin-bottom: 0; }
  .analysis-card strong { color: var(--verde-bosque); }
  .highlight-box {
    background: var(--verde-hielo); border-left: 4px solid var(--verde-claro);
    border-radius: 0 8px 8px 0; padding: 12px 16px; margin: 12px 0;
    font-size: 13px; color: var(--verde-bosque);
  }
  .alert-box {
    background: var(--rojo-claro); border-left: 4px solid var(--rojo-alerta);
    border-radius: 0 8px 8px 0; padding: 12px 16px; margin: 12px 0;
    font-size: 13px; color: var(--rojo-alerta);
  }
  .warn-box {
    background: var(--ocre-claro); border-left: 4px solid var(--ocre);
    border-radius: 0 8px 8px 0; padding: 12px 16px; margin: 12px 0;
    font-size: 13px; color: #7B4F00;
  }

  /* ─── BARRIO BARS ─── */
  .barrio-bar-item { margin-bottom: 12px; }
  .barrio-bar-top { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px; }
  .barrio-bar-name { font-size: 12px; font-weight: 600; color: var(--gris-text); }
  .barrio-bar-val { font-family: 'IBM Plex Mono', monospace; font-size: 11px; color: var(--verde-bosque); }
  .barrio-bar-track { height: 8px; background: var(--verde-hielo); border-radius: 100px; overflow: hidden; }
  .barrio-bar-fill { height: 100%; border-radius: 100px; background: linear-gradient(to right, var(--verde-esmeralda), var(--verde-claro)); }

  /* ─── FOOTER ─── */
  .footer {
    background: var(--verde-bosque); color: rgba(255,255,255,0.6);
    padding: 32px 40px; text-align: center; font-size: 11px; line-height: 1.8;
  }
  .footer strong { color: rgba(255,255,255,0.9); }

  /* ─── RESPONSIVE ─── */
  @media (max-width: 960px) {
    .hero-inner { grid-template-columns: 1fr; gap: 28px; }
    .hero-kpi-grid { grid-template-columns: repeat(4, 1fr); min-width: unset; width: 100%; }
    .charts-grid.wide  { grid-template-columns: 1fr; }
    .charts-grid.three { grid-template-columns: 1fr 1fr; }
    .stats-row { grid-template-columns: repeat(3, 1fr); }
    .analysis-grid { grid-template-columns: 1fr; }
  }
  @media (max-width: 640px) {
    .hero-inner { padding: 36px 16px 28px; }
    .container  { padding: 0 16px; }
    .section    { padding: 32px 0; }
    .hero-kpi-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
    .hero-kpi      { padding: 12px 14px; }
    .hero-kpi-val  { font-size: 20px; }
    .alert-strip   { padding: 10px 16px; font-size: 11px; flex-wrap: wrap; gap: 6px; }
    .charts-grid, .charts-grid.three, .charts-grid.wide { grid-template-columns: 1fr; }
    .stats-row { grid-template-columns: 1fr 1fr; gap: 10px; }
    .stat-card { padding: 16px 14px; }
    .stat-num  { font-size: 26px; }
    .table-wrap  { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    table        { min-width: 600px; font-size: 11px; }
    th, td       { padding: 8px 10px; }
    h2 { font-size: 20px; }
    .section-header { gap: 8px; flex-wrap: wrap; }
    .footer { padding: 24px 16px; font-size: 10px; }
    .analysis-card { padding: 20px 16px; }
    .analysis-card h3 { font-size: 15px; }
    .chart-card-header { flex-direction: column; gap: 6px; }
  }
  @media (max-width: 400px) {
    .stats-row { grid-template-columns: 1fr; }
    .hero-kpi-grid { grid-template-columns: 1fr 1fr; }
    .hero-kpi-val  { font-size: 18px; }
  }

  /* ─── CHART WRAPPERS ─── */
  .chart-wrap { position: relative; height: 240px; width: 100%; }
  .chart-wrap-tall { position: relative; height: 300px; width: 100%; }
  .chart-wrap-donut { position: relative; height: 260px; width: 100%; max-width: 320px; margin: 0 auto; }
  .chart-body-center { display: flex; align-items: center; justify-content: center; padding-top: 16px; }

  @media (max-width: 640px) {
    .chart-wrap       { height: 200px; }
    .chart-wrap-tall  { height: 260px; }
    .chart-wrap-donut { height: 220px; max-width: 100%; }
  }
  @media (max-width: 400px) {
    .chart-wrap       { height: 180px; }
    .chart-wrap-tall  { height: 230px; }
    .chart-wrap-donut { height: 200px; }
  }
</style>
</head>
<body>

<header class="hero">
  <div class="hero-bg-art"></div>
  <div class="hero-lines"></div>
  <div class="hero-inner">
    <div>
      <div class="hero-tag">Distrito de Aguablanca · Cali, Colombia</div>
      <h1>Pulmón del<br><span>Oriente</span></h1>
      <p class="hero-sub">Informe de Inversión Pública <br>Municipio de Santiago de Cali · Pulmon del oriente</p>
      <p class="hero-date">// ACTUALIZACIÓN: DINÁMICA GEOJSON · FUENTE: SECRETARÍAS DISTRITALES</p>
    </div>
    <div class="hero-kpi-grid">
      <div class="hero-kpi accent">
        <div class="hero-kpi-val">...</div>
        <div class="hero-kpi-lbl">Proyectos Totales</div>
      </div>
      <div class="hero-kpi">
        <div class="hero-kpi-val">...</div>
        <div class="hero-kpi-lbl">Inversión COP</div>
      </div>
      <div class="hero-kpi">
        <div class="hero-kpi-val">2027</div>
        <div class="hero-kpi-lbl">Horizonte</div>
      </div>
    </div>
  </div>
</header>

<div class="alert-strip">
  ALERTA DINÁMICA: Procesando la información geoespacial y calculando el estado actual de los proyectos en el Área de Influencia...
</div>

<section class="section">
  <div class="container">
    <div class="section-header">
      <span class="section-num">01 —</span>
      <h2>Estado General de la Inversión</h2>
    </div>
    <div class="divider"></div>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-num">...</div>
        <div class="stat-lbl">Total Proyectos</div>
        <div class="stat-sub">Inventario completo zona Pulmón del Oriente</div>
      </div>
      <div class="stat-card alistamiento">
        <div class="stat-num">...</div>
        <div class="stat-lbl">En Alistamiento</div>
        <div class="stat-sub">Pendientes de iniciar obras constructivas</div>
      </div>
      <div class="stat-card ejecucion">
        <div class="stat-num">...</div>
        <div class="stat-lbl">En Ejecución</div>
        <div class="stat-sub">Obras y proyectos actualmente en marcha</div>
      </div>
      <div class="stat-card terminado">
        <div class="stat-num">...</div>
        <div class="stat-lbl">Terminados</div>
        <div class="stat-sub">Proyectos con obra civil finalizada</div>
      </div>
      <div class="stat-card alerta">
        <div class="stat-num">...</div>
        <div class="stat-lbl">Suspendidos</div>
        <div class="stat-sub">Obras detenidas temporal o indefinidamente</div>
      </div>
    </div>

    <div class="charts-grid wide">
      <div class="chart-card">
        <div class="chart-card-header">
          <div>
            <div class="chart-card-title">Inversión por Secretaría</div>
            <div class="chart-card-sub">Distribución del presupuesto consolidado</div>
          </div>
        </div>
        <div class="chart-body">
          <div class="chart-wrap"><canvas id="chartSecretaria"></canvas></div>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-card-header">
          <div>
            <div class="chart-card-title">Estado de Proyectos</div>
            <div class="chart-card-sub">Distribución por número de obras</div>
          </div>
        </div>
        <div class="chart-body chart-body-center">
          <div class="chart-wrap chart-wrap-donut"><canvas id="chartEstado"></canvas></div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section" style="padding-top:0">
  <div class="container">
    <div class="section-header">
      <span class="section-num">02 —</span>
      <h2>Tipos de Intervención</h2>
    </div>
    <div class="divider"></div>

    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-card-header">
          <div>
            <div class="chart-card-title">Inversión por Tipo de Equipamiento</div>
            <div class="chart-card-sub">Millones de COP invertidos por categoría</div>
          </div>
        </div>
        <div class="chart-body">
          <div class="chart-wrap chart-wrap-tall"><canvas id="chartTipo"></canvas></div>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-card-header">
          <div>
            <div class="chart-card-title">Inversión Anualizada</div>
            <div class="chart-card-sub">Presupuesto asignado por año de reporte</div>
          </div>
        </div>
        <div class="chart-body">
          <div class="chart-wrap"><canvas id="chartAnio"></canvas></div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section" style="padding-top:0">
  <div class="container">
    <div class="section-header">
      <span class="section-num">03 —</span>
      <h2>Inversión por Barrio / Sector</h2>
    </div>
    <div class="divider"></div>

    <div class="charts-grid wide">
      <div class="chart-card">
        <div class="chart-card-header">
          <div>
            <div class="chart-card-title">Top 10 Barrios · Mayor Inversión</div>
            <div class="chart-card-sub">Millones de COP asignados al sector</div>
          </div>
        </div>
        <div class="chart-body" style="padding-top:20px;">
          <div id="barriosBars"></div>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-card-header">
          <div>
            <div class="chart-card-title">Proyectos por Barrio</div>
            <div class="chart-card-sub">Número de obras y contratos identificados</div>
          </div>
        </div>
        <div class="chart-body">
          <div class="chart-wrap chart-wrap-tall"><canvas id="chartBarrios"></canvas></div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section" style="padding-top:0">
  <div class="container">
    <div class="section-header">
      <span class="section-num">04 —</span>
      <h2>Proyectos Destacados en Ejecución</h2>
    </div>
    <div class="divider"></div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>SECRETARÍA</th>
            <th>TIPO</th>
            <th>NOMBRE DEL PROYECTO</th>
            <th>BARRIO</th>
            <th>PRESUPUESTO</th>
            <th>AVANCE</th>
            <th>ESTADO</th>
          </tr>
        </thead>
        <tbody id="proyectosTable"></tbody>
      </table>
    </div>
  </div>
</section>

<section class="section" style="padding-top:0">
  <div class="container">
    <div class="section-header">
      <span class="section-num">05 —</span>
      <h2>Análisis y Hallazgos</h2>
    </div>
    <div class="divider"></div>

    <div class="analysis-grid">
      <div class="analysis-card">
        <h3>Contexto del Pulmón del Oriente</h3>
        <p>El Pulmón del Oriente es un corredor ambiental y de desarrollo social estratégico para el oriente de Cali.</p>
        <p>La gran mayoría de los proyectos corresponden a inversión social directa: vivienda, educación, salud y recreación. Esto refleja una estrategia de transformación territorial integral que va más allá de la recuperación ecológica.</p>
      </div>

      <div class="analysis-card">
        <h3>Alertas Generales</h3>
        <div class="alert-box">
          <strong>Proyectos Suspendidos:</strong> Los proyectos de parques y zonas verdes que se encuentren suspendidos representan una paradoja para el avance integral del corredor ambiental.
        </div>
        <div class="warn-box">
          <strong>Fase de Alistamiento:</strong> Una gran porción de la cartera se mantiene en fase inicial. Si no se aceleran los procesos contractuales, existe riesgo de rezago en la ejecución del Plan de Desarrollo.
        </div>
      </div>
    </div>
  </div>
</section>

<footer class="footer">
  <strong>Pulmón del Oriente · Cali · Informe de Inversión Pública</strong><br>
  Fuente: Unidad de Proyectos (UP) · Secretarías Distritales · Municipio de Santiago de Cali<br>
  Cálculo: Generado dinámicamente mediante análisis espacial del perímetro.
</footer>

<nav class="page-switcher" aria-label="Navegación entre vistas">
  <a class="switcher-home" href="../index.html" title="Inicio">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  </a>
  <div class="switcher-divider"></div>
  <a class="switcher-btn active" href="pulmon_oriente_informe-v2.html" aria-current="page">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4zm2.5 2.1H4.5V5h15v14.1zm0-16.1h-15C3.6 3 3 3.6 3 4.5v15C3 20.4 3.6 21 4.5 21h15c.9 0 1.5-.6 1.5-1.5v-15C21 3.6 20.4 3 19.5 3z"/></svg>
    Informe
  </a>
  <a class="switcher-btn" href="pulmon_oriente_mapa_v2.html">
    <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/></svg>
    Mapa
  </a>
</nav>

<style>
.page-switcher { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; align-items: center; gap: 0; background: rgba(27, 77, 46, 0.96); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-radius: 40px; padding: 6px 10px; box-shadow: 0 6px 28px rgba(0,0,0,0.28), 0 1px 4px rgba(0,0,0,0.15); border: 1px solid rgba(76, 175, 119, 0.25); }
.switcher-home { display: flex; align-items: center; justify-content: center; width: 30px; height: 30px; border-radius: 50%; color: rgba(255,255,255,0.65); text-decoration: none; transition: all 0.2s; flex-shrink: 0; }
.switcher-home:hover { color: #fff; background: rgba(255,255,255,0.12); }
.switcher-divider { width: 1px; height: 20px; background: rgba(255,255,255,0.18); margin: 0 6px; flex-shrink: 0; }
.switcher-btn { display: flex; align-items: center; gap: 5px; padding: 6px 14px; border-radius: 30px; font-family: 'IBM Plex Sans', sans-serif; font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.72); text-decoration: none; letter-spacing: 0.03em; transition: all 0.2s; white-space: nowrap; }
.switcher-btn:hover { color: #fff; background: rgba(255,255,255,0.1); }
.switcher-btn.active { background: #4CAF77; color: #1B4D2E; font-weight: 600; }
.switcher-btn.active:hover { background: #5DC88A; }
@media (max-width: 480px) { .page-switcher { bottom: 14px; padding: 5px 8px; } .switcher-btn { padding: 5px 10px; font-size: 11px; } }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<script>
Chart.defaults.font.family = "'Inter', sans-serif";
Chart.defaults.color = '#37474F';

const COLORES = {
  verde_bosque:    '#1B4D2E',
  verde_esmeralda: '#2E7D52',
  verde_claro:     '#4CAF50',
  verde_menta:     '#A5D6A7',
  verde_hielo:     '#C8E6C9',
  ocre:            '#F57F17',
  rojo:            '#9E4242',
  azul:            '#0277BD',
  azul_claro:      '#64B5F6',
  tierra:          '#5D4037',
  lila:            '#6A1B9A',
  lila_cl:         '#CE93D8',
};

function secGroup(s) {
  if (!s) return "Otras";
  if (s.includes("Vivienda") || s.includes("Hábitat")) return "Vivienda y Hábitat";
  if (s.includes("Educación") || s.includes("Educacion")) return "Educación";
  if (s.includes("Salud")) return "Salud Pública";
  if (s.includes("Deporte") || s.includes("Recreación")) return "Deporte y Recreación";
  if (s.includes("Cultura")) return "Cultura";
  if (s.includes("Seguridad") || s.includes("Justicia")) return "Seguridad y Justicia";
  if (s.includes("Medio Ambiente") || s.includes("DAGMA")) return "DAGMA";
  return "Otras";
}

async function initDynamicDashboard() {
  try {
    const [ptsRes, polyRes] = await Promise.all([
      fetch('../Total_secretarias.geojson'),
      fetch('../poligonos.geojson')
    ]);
    const ptsData = await ptsRes.json();
    const polyData = await polyRes.json();

    const perimetro = polyData.features.find(f => f.properties.Name === 'Perimetro Proyecto') || polyData.features[0];
    const proyectos = [];
    let totalInversion = 0;

    // Agrupadores para las gráficas
    const dataSec = {};
    const dataEst = {'En ejecución':0, 'En alistamiento':0, 'Terminado':0, 'Suspendido':0};
    const dataTipo = {};
    const dataBarrio = {};
    const barrioCount = {};
    const dataAnio = {};

    // 1. Filtrado Espacial Estricto
    ptsData.features.forEach(f => {
      if (!f.geometry || !turf.booleanPointInPolygon(f, perimetro)) return;
      
      const props = f.properties;
      let pptoStr = (props.presupuest || '0').toString().trim();
      pptoStr = pptoStr.replace(/[^0-9\.,]/g, ''); 
      if (pptoStr.endsWith('.00') || pptoStr.endsWith(',00')) pptoStr = pptoStr.slice(0, -3);
      const ppto = parseFloat(pptoStr.replace(/[\.,]/g, '')) || 0;

      const secReal = props.nombre_cen || 'Otra';
      const secGrp = secGroup(secReal);
      
      let estOriginal = props.estado || 'Alistamiento';
      let estClean = estOriginal.toLowerCase();
      let estKey = 'En alistamiento';
      if(estClean.includes('ejecuc')) estKey = 'En ejecución';
      else if(estClean.includes('terminad')) estKey = 'Terminado';
      else if(estClean.includes('suspendid')) estKey = 'Suspendido';

      const tipo = props.tipo_equip || 'Otro';
      const barrio = props.barrio_ver || 'Sin dato';
      const avance = parseFloat(props.avance_obr) || 0;
      
      let yr = (props.año || '2025').toString().trim();
      if(yr === 'null' || yr === '') yr = '2025';

      proyectos.push({
        nombre: props.nombre_up || 'Sin Nombre', 
        secretaria: secGrp,
        estadoKey: estKey,
        estadoOriginal: estOriginal,
        tipo: tipo, 
        barrio: barrio,
        avance: avance, 
        presupuesto: ppto, 
        año: yr
      });
      
      totalInversion += ppto;

      // Sumarizadores
      dataSec[secGrp] = (dataSec[secGrp] || 0) + ppto;
      dataTipo[tipo] = (dataTipo[tipo] || 0) + ppto;
      dataBarrio[barrio] = (dataBarrio[barrio] || 0) + ppto;
      barrioCount[barrio] = (barrioCount[barrio] || 0) + 1;
      dataAnio[yr] = (dataAnio[yr] || 0) + ppto;
      dataEst[estKey]++;
    });

    // 2. Actualizar KPIs del DOM
    const heroVals = document.querySelectorAll('.hero-kpi-val');
    if(heroVals.length > 1) {
      heroVals[0].innerText = proyectos.length;
      heroVals[1].innerText = '$' + Math.round(totalInversion / 1e6).toLocaleString('es-CO') + 'M';
    }

    const statNums = document.querySelectorAll('.stat-num');
    if(statNums.length > 4) {
      statNums[0].innerText = proyectos.length;
      statNums[1].innerText = dataEst['En alistamiento'];
      statNums[2].innerText = dataEst['En ejecución'];
      statNums[3].innerText = dataEst['Terminado'];
      statNums[4].innerText = dataEst['Suspendido'];
    }

    // 2.5 Actualizar la Alerta Dinámica
    const alertStrip = document.querySelector('.alert-strip');
    if (alertStrip) {
      const suspCount = dataEst['Suspendido'] || 0;
      const alistCount = dataEst['En alistamiento'] || 0;
      const alistPct = proyectos.length > 0 ? ((alistCount / proyectos.length) * 100).toFixed(1) : 0;
      
      if (suspCount > 0) {
        alertStrip.innerHTML = `⚠️ ALERTA: <strong>${suspCount} proyectos SUSPENDIDOS</strong> · ${alistCount} proyectos (${alistPct}%) en fase de alistamiento sin iniciar obras.`;
        alertStrip.style.background = '#5C2E2E';
      } else {
        alertStrip.innerHTML = `✅ DATOS PROCESADOS: ${proyectos.length} proyectos localizados · ${alistCount} en alistamiento (${alistPct}%). No se reportan obras suspendidas.`;
        alertStrip.style.background = '#1B4D2E'; // Se pone verde si no hay suspendidos
      }
    }

    // 3. Renderizar Gráficas Dinámicas
    
    // Gráfica Secretarías
    const secSorted = Object.entries(dataSec).sort((a,b) => b[1]-a[1]);
    new Chart(document.getElementById('chartSecretaria'), {
      type: 'bar',
      data: {
        labels: secSorted.map(s => s[0]),
        datasets: [{
          data: secSorted.map(s => Math.round(s[1]/1e6)),
          backgroundColor: [COLORES.verde_bosque, COLORES.verde_esmeralda, COLORES.azul, COLORES.verde_claro, COLORES.tierra, COLORES.rojo, COLORES.lila, COLORES.ocre, COLORES.verde_menta],
          borderRadius: 6
        }]
      },
      options: {
        indexAxis: 'y', responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => ` $${ctx.parsed.x.toLocaleString('es-CO')}M COP` } } },
        scales: { x: { ticks: { callback: v => `$${v}M` } }, y: { grid: { display: false }, ticks: { font: { size: 11 } } } }
      }
    });

    // Gráfica Estado (Donut)
    new Chart(document.getElementById('chartEstado'), {
      type: 'doughnut',
      data: {
        labels: Object.keys(dataEst),
        datasets: [{
          data: Object.values(dataEst),
          backgroundColor: [COLORES.verde_claro, COLORES.azul, COLORES.verde_bosque, COLORES.rojo],
          borderWidth: 2, borderColor: '#fff'
        }]
      },
      options: {
        responsive: true, maintainAspectRatio: false, cutout: '62%',
        plugins: {
          legend: { position: 'bottom', labels: { padding: 12, font: { size: 11 } } },
          tooltip: { callbacks: { label: ctx => ` ${ctx.label}: ${ctx.parsed} (${(ctx.parsed/proyectos.length*100).toFixed(1)}%)` } }
        }
      }
    });

    // Gráfica Tipo
    const tipoSorted = Object.entries(dataTipo).sort((a,b) => b[1]-a[1]).slice(0, 10);
    new Chart(document.getElementById('chartTipo'), {
      type: 'bar',
      data: {
        labels: tipoSorted.map(s => s[0]),
        datasets: [{
          data: tipoSorted.map(s => Math.round(s[1]/1e6)),
          backgroundColor: [COLORES.verde_bosque, COLORES.verde_esmeralda, COLORES.azul, COLORES.verde_claro, COLORES.verde_menta, COLORES.lila, COLORES.azul_claro, COLORES.tierra, COLORES.lila_cl, COLORES.ocre],
          borderRadius: 6
        }]
      },
      options: {
        indexAxis: 'y', responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => ` $${ctx.parsed.x.toLocaleString('es-CO')}M COP` } } },
        scales: { x: { ticks: { callback: v => `$${v}M` } }, y: { grid: { display: false }, ticks: { font: { size: 10 } } } }
      }
    });

    // Gráfica Año
    const anioSorted = Object.entries(dataAnio).sort((a,b) => a[0].localeCompare(b[0]));
    new Chart(document.getElementById('chartAnio'), {
      type: 'bar',
      data: {
        labels: anioSorted.map(a => a[0]),
        datasets: [{
          data: anioSorted.map(a => Math.round(a[1]/1e6)),
          backgroundColor: [COLORES.verde_menta, COLORES.verde_bosque, COLORES.verde_esmeralda, COLORES.verde_claro],
          borderRadius: 8
        }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => ` $${ctx.parsed.y.toLocaleString('es-CO')}M COP` } } },
        scales: { y: { ticks: { callback: v => `$${v}M` } }, x: { grid: { display: false } } }
      }
    });

    // Ranking Barrios (HTML Custom)
    const bPptoSorted = Object.entries(dataBarrio).sort((a,b) => b[1]-a[1]).slice(0, 10);
    const bContainer = document.getElementById('barriosBars');
    if(bPptoSorted.length > 0 && bContainer) {
      const maxVal = bPptoSorted[0][1];
      bPptoSorted.forEach(b => {
        const pct = (b[1] / maxVal * 100).toFixed(1);
        bContainer.innerHTML += `
          <div class="barrio-bar-item">
            <div class="barrio-bar-top">
              <span class="barrio-bar-name">${b[0]}</span>
              <span class="barrio-bar-val">$${Math.round(b[1]/1e6).toLocaleString('es-CO')}M</span>
            </div>
            <div class="barrio-bar-track">
              <div class="barrio-bar-fill" style="width:${pct}%"></div>
            </div>
          </div>`;
      });
    }

    // Gráfica Barrios (Conteo de proyectos)
    const bCountSorted = Object.entries(barrioCount).sort((a,b) => b[1]-a[1]).slice(0, 10);
    new Chart(document.getElementById('chartBarrios'), {
      type: 'bar',
      data: {
        labels: bCountSorted.map(b => b[0]),
        datasets: [{
          data: bCountSorted.map(b => b[1]),
          backgroundColor: COLORES.verde_esmeralda,
          borderRadius: 6
        }]
      },
      options: {
        indexAxis: 'y', responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { grid: { display: false }, ticks: { font: { size: 9 } } } }
      }
    });

    // 4. Poblar Tabla de Ejecución
    const tbody = document.getElementById('proyectosTable');
    if(tbody) {
      const enEjecucion = proyectos.filter(p => p.estadoKey === 'En ejecución' && p.presupuesto > 0);
      enEjecucion.sort((a,b) => b.presupuesto - a.presupuesto).slice(0, 15).forEach(p => {
        const avColor = p.avance >= 70 ? '#2E7D52' : p.avance >= 30 ? '#F57F17' : '#C62828';
        tbody.innerHTML += `
          <tr>
            <td><strong>${p.secretaria}</strong></td>
            <td>${p.tipo}</td>
            <td>${p.nombre}</td>
            <td>${p.barrio}</td>
            <td><strong>$${Math.round(p.presupuesto/1e6).toLocaleString('es-CO')}M</strong></td>
            <td><span style="color:${avColor}; font-weight:600; font-family:'IBM Plex Mono',monospace">${p.avance}%</span></td>
            <td><span class="pill pill-ej">En ejecución</span></td>
          </tr>`;
      });
      // Si no hay obras en ejecución, mostrar un mensaje
      if(enEjecucion.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding: 20px;">No hay proyectos con presupuesto reportado que estén actualmente en ejecución.</td></tr>`;
      }
    }

  } catch (error) {
    console.error("Error al construir el dashboard dinámico:", error);
  }
}

// Iniciar al cargar
initDynamicDashboard();
</script>
</body>
</html>